# 테스트 데이터 생성 Task

## 목표
- 설문 시스템에 테스트 데이터 추가
- 설문 데이터와 다양한 사용자의 응답 데이터 생성
- 데이터 적합성에 맞는 테스트 데이터 준비
- 최종 결과물: `test_data.sql` 파일에 INSERT 문 100~500개

## 작업 단계

### 1단계: 분석 및 이해

#### ✅ 1.1 데이터베이스 스키마 분석
- [x] USER 테이블 구조 파악
  - ID (BIGINT AUTO_INCREMENT), USERNAME (VARCHAR(50) UNIQUE), PASSWORD (VARCHAR(255))
  - BIRTH_DATE (DATE), ROLE (ENUM: ADMIN, CREATOR, RESPONDER, 기본값 RESPONDER)
  - CREATED_AT, UPDATED_AT (TIMESTAMP)
- [x] SURVEYS 테이블 구조 파악
  - ID (BIGINT AUTO_INCREMENT), USER_ID (BIGINT NOT NULL), TITLE (VARCHAR(255))
  - DESCRIPTION (TEXT), START_TIME (DATETIME nullable), END_TIME (DATETIME NOT NULL)
  - IS_ACTIVE (BOOLEAN, 기본값 TRUE), IS_DELETED (TINYINT(1), 기본값 0)
  - CREATED_AT, UPDATED_AT (TIMESTAMP)
- [x] QUESTIONS 테이블 구조 파악
  - ID (BIGINT AUTO_INCREMENT), SURVEY_ID (BIGINT NOT NULL)
  - TYPE (ENUM: MULTIPLE_CHOICE, SUBJECTIVE, SCALE - **SCALE은 현재 미지원**)
  - CONTENT (TEXT NOT NULL), ORDER_INDEX (INT NOT NULL)
- [x] OPTIONS 테이블 구조 파악
  - ID (BIGINT AUTO_INCREMENT), QUESTION_ID (BIGINT NOT NULL)
  - CONTENT (VARCHAR(500) NOT NULL)
- [x] RESPONSES 테이블 구조 파악
  - ID (BIGINT AUTO_INCREMENT), RESPONSE_SESSION_ID (VARCHAR(36) NOT NULL)
  - QUESTION_ID (BIGINT NOT NULL), QUESTION_TYPE (TEXT NOT NULL)
  - OPTION_ID (BIGINT nullable), SUBJECTIVE_CONTENT (TEXT nullable)
  - SCALE_VALUE (INT nullable), CREATED_AT (TIMESTAMP NOT NULL)
- [x] SURVEY_RESPONSE_HISTORY 테이블 구조 파악
  - ID (BIGINT AUTO_INCREMENT), SURVEY_ID (BIGINT NOT NULL)
  - DEVICE_ID_HASH (VARCHAR(255) NOT NULL), IP_ADDRESS_HASH (VARCHAR(255) nullable)
  - RESPONDED_AT (DATETIME, 기본값 CURRENT_TIMESTAMP)
- [x] NOTIFICATIONS 테이블 구조 파악
  - ID (BIGINT AUTO_INCREMENT), RECIPIENT_ID (BIGINT NOT NULL)
  - TYPE (VARCHAR(50) NOT NULL), MESSAGE (TEXT NOT NULL)
  - REFERENCE_ID (BIGINT nullable), IS_READ (BOOLEAN 기본값 FALSE)
  - CREATED_AT (DATETIME 기본값 CURRENT_TIMESTAMP), EXPIRES_AT (DATETIME nullable)

#### ✅ 1.2 데이터 흐름 분석
- [x] 설문 생성 프로세스 이해
  - CREATOR 사용자가 설문 생성 (SURVEYS)
  - 설문에 질문 추가 (QUESTIONS)
  - 객관식 질문에 선택지 추가 (OPTIONS)
- [x] 응답 제출 프로세스 이해
  - 응답자가 설문에 응답 제출
  - 각 질문별로 RESPONSES 레코드 생성
  - 같은 세션의 응답은 responseSessionId(UUID)로 그룹화
  - SURVEY_RESPONSE_HISTORY에 응답 이력 저장 (deviceIdHash, ipAddressHash 포함)
- [x] 데이터 관계도 파악
  ```
  USER (CREATOR) 
    ↓
  SURVEYS (설문)
    ↓
  QUESTIONS (질문: MULTIPLE_CHOICE, SUBJECTIVE - SCALE은 미지원)
    ↓
  OPTIONS (객관식 선택지 - MULTIPLE_CHOICE 전용)
    ↓
  RESPONSES (응답 - responseSessionId로 그룹화)
    ↓
  SURVEY_RESPONSE_HISTORY (응답 이력)
  ```

#### 🔄 1.3 제약 조건 파악
- [x] 각 테이블의 NOT NULL 제약 조건 확인
  - USER: ID, USERNAME, PASSWORD, ROLE, CREATED_AT, UPDATED_AT
  - SURVEYS: ID, USER_ID, TITLE, END_TIME, IS_ACTIVE, IS_DELETED, CREATED_AT, UPDATED_AT
  - QUESTIONS: ID, SURVEY_ID, TYPE, CONTENT, ORDER_INDEX
  - OPTIONS: ID, QUESTION_ID, CONTENT
  - RESPONSES: ID, RESPONSE_SESSION_ID, QUESTION_ID, QUESTION_TYPE, CREATED_AT
  - SURVEY_RESPONSE_HISTORY: ID, SURVEY_ID, DEVICE_ID_HASH, RESPONDED_AT
  - NOTIFICATIONS: ID, RECIPIENT_ID, TYPE, MESSAGE, IS_READ, CREATED_AT
- [x] ENUM 타입 값 검증
  - USER.ROLE: ADMIN, CREATOR, RESPONDER (기본값: RESPONDER)
  - QUESTIONS.TYPE: MULTIPLE_CHOICE, SUBJECTIVE, SCALE (SCALE 미지원)
- [x] 외래키 관계 파악
  - SURVEYS.USER_ID → USER.ID
  - QUESTIONS.SURVEY_ID → SURVEYS.ID
  - OPTIONS.QUESTION_ID → QUESTIONS.ID
  - RESPONSES.QUESTION_ID → QUESTIONS.ID
  - RESPONSES.OPTION_ID → OPTIONS.ID (MULTIPLE_CHOICE인 경우)
  - SURVEY_RESPONSE_HISTORY.SURVEY_ID → SURVEYS.ID
  - NOTIFICATIONS.RECIPIENT_ID → USER.ID
- [x] 날짜 범위 제약
  - SURVEYS.END_TIME는 필수, START_TIME은 선택
  - END_TIME >= START_TIME (논리적 제약)
  - RESPONSES.CREATED_AT는 설문 기간 내여야 함
- [x] UUID 형식 확인
  - RESPONSE_SESSION_ID: VARCHAR(36) - UUID v4 형식 (예: "550e8400-e29b-41d4-a716-446655440000")
- [x] 해시 값 형식 확인
  - DEVICE_ID_HASH, IP_ADDRESS_HASH: SHA256 해시를 Base64 인코딩 (HashUtil.encodeSha256 사용)

### 2단계: 테스트 데이터 생성

#### 📝 2.1 테스트 사용자 데이터 생성
- [x] CREATOR 역할 사용자 8명 생성
  - USERNAME: test_creator_1@example.com ~ test_creator_8@example.com
  - PASSWORD: BCrypt 해시 (비밀번호 "test1234")
  - BIRTH_DATE: 1982-1996년 다양한 연령대
  - ROLE: CREATOR
- [x] ADMIN 역할 사용자 2명 생성
  - USERNAME: test_admin_1@example.com, test_admin_2@example.com
- [ ] RESPONDER 역할 사용자 3-5명 생성 (선택사항)
- [x] 생성 시각 다양화 (최근 1년 내 분산)

#### 📝 2.2 테스트 설문 데이터 생성
- [x] 각 CREATOR당 3-5개 설문 생성 (현재 20개 생성됨 - 기존 16개 + 신규 4개)
  - 신규 추가: 리그오브레전드, 스타벅스, 주식 투자, 반려동물 설문
- [x] 설문 상태 다양화
  - IS_ACTIVE: TRUE/FALSE 혼합
  - IS_DELETED: 대부분 FALSE
- [x] 설문 기간 다양화
  - 진행 중인 설문: Survey ID 1, 6, 9, 12, 14, 16
  - 예정된 설문: Survey ID 3
  - 종료된 설문: Survey ID 2, 5, 8, 11, 13, 15
- [x] 설문 제목/설명 다양화
  - 다양한 주제 (서비스 만족도, 제품 피드백, 이벤트 참여 등)

#### 📝 2.3 테스트 질문 데이터 생성
- [x] 신규 설문 4개에 대한 질문 생성 (각 설문당 2개 질문)
  - 리그오브레전드: 객관식 1개, 주관식 1개
  - 스타벅스: 객관식 1개, 주관식 1개
  - 주식 투자: 객관식 1개, 주관식 1개
  - 반려동물: 객관식 1개, 주관식 1개
- [x] 질문 타입 다양화 (SCALE 타입은 현재 미지원이므로 제외)
  - MULTIPLE_CHOICE: 50% (객관식)
  - SUBJECTIVE: 50% (주관식)
- [x] ORDER_INDEX 순서 보장 (1부터 시작, 연속)
- [x] 질문 내용 다양화 (제공된 실제 질문 사용)

#### 📝 2.4 테스트 옵션 데이터 생성
- [x] MULTIPLE_CHOICE 타입 질문에만 옵션 추가
  - 리그오브레전드 포지션: 5개 옵션 (탑, 정글, 미드, 원딜, 서포터)
  - 스타벅스 음료: 5개 옵션 (아메리카노, 라떼, 프라푸치노, 티 음료, 시즌 한정 메뉴)
  - 주식 투자 스타일: 5개 옵션 (단기 매매, 스윙, 중기, 장기 가치, 인덱스/ETF)
  - 반려동물 유형: 6개 옵션 (강아지, 고양이, 소형 포유류, 파충류, 조류, 기타)
- [x] 질문당 2-6개 옵션 생성
- [x] 옵션 내용 다양화 (제공된 실제 선택지 사용)

#### 📝 2.5 테스트 응답 데이터 생성
- [x] 신규 설문 4개에 대한 응답 세션 생성 (집계를 위한 대량 데이터)
  - 리그오브레전드: 약 20개 응답 세션 (40개 응답)
  - 스타벅스: 약 10개 응답 세션 (20개 응답)
  - 주식 투자: 약 20개 응답 세션 (40개 응답)
  - 반려동물: 약 20개 응답 세션 (40개 응답)
  - 총 약 70개 응답 세션, 140개 응답
- [x] responseSessionId로 그룹화
  - 각 세션은 설문의 모든 질문에 응답 (UUID로 그룹화)
- [x] 질문 타입별 응답 데이터 (SCALE 타입은 현재 미지원이므로 제외)
  - MULTIPLE_CHOICE: OPTION_ID 사용 (다양한 옵션 선택)
  - SUBJECTIVE: SUBJECTIVE_CONTENT 사용 (실제적인 다양한 답변 텍스트)
- [x] 응답 시각 다양화 (설문 기간 내 분산)
- [ ] 일부 부분 응답 시나리오 (향후 추가 가능)

#### 📝 2.6 테스트 응답 이력 데이터 생성
- [x] SURVEY_RESPONSE_HISTORY에 각 응답 세션당 1개 레코드
  - 리그오브레전드: 약 20개 이력
  - 스타벅스: 약 10개 이력
  - 주식 투자: 약 20개 이력
  - 반려동물: 약 20개 이력
  - 총 약 70개 응답 이력
- [x] DEVICE_ID_HASH: SHA256 해시된 디바이스 ID (Base64 인코딩)
- [x] IP_ADDRESS_HASH: SHA256 해시된 IP 주소 (Base64 인코딩)
- [x] RESPONDED_AT: 응답 생성 시각과 일치

#### 📝 2.7 테스트 알림 데이터 생성 (선택사항)
- [ ] NOTIFICATIONS 테이블에 알림 데이터 추가
- [ ] RECIPIENT_ID: CREATOR 사용자 ID
- [ ] TYPE: 다양한 알림 타입
- [ ] REFERENCE_ID: SURVEY_ID 참조
- [ ] IS_READ: TRUE/FALSE 혼합

### 3단계: 검증 및 파일 생성

#### ✅ 3.1 데이터 적합성 검증
- [ ] 외래키 관계 확인
  - SURVEYS.USER_ID → USER.ID
  - QUESTIONS.SURVEY_ID → SURVEYS.ID
  - OPTIONS.QUESTION_ID → QUESTIONS.ID
  - RESPONSES.QUESTION_ID → QUESTIONS.ID
  - RESPONSES.OPTION_ID → OPTIONS.ID (MULTIPLE_CHOICE인 경우)
- [ ] ENUM 값 검증
  - USER.ROLE: ADMIN, CREATOR, RESPONDER만 사용
  - QUESTIONS.TYPE: MULTIPLE_CHOICE, SUBJECTIVE만 사용 (SCALE은 현재 미지원)
- [ ] NULL 제약 조건 확인
  - NOT NULL 필드는 모두 값 포함
  - 조건부 NULL (MULTIPLE_CHOICE는 OPTION_ID만, SUBJECTIVE는 SUBJECTIVE_CONTENT만)
  - SCALE 타입은 사용하지 않으므로 SCALE_VALUE는 NULL
- [ ] 날짜 범위 검증
  - SURVEYS.END_TIME >= START_TIME
  - RESPONSES.CREATED_AT가 설문 기간 내
- [ ] UUID 형식 검증
  - RESPONSE_SESSION_ID는 36자 UUID 형식 (8-4-4-4-12)
- [ ] 해시 값 형식 검증
  - DEVICE_ID_HASH, IP_ADDRESS_HASH는 SHA256 해시 (64자 hex)

#### 📄 3.2 SQL 파일 생성
- [x] `test_data.sql` 파일 생성 (기본 구조 완료)
- [x] INSERT 문 100~500개 작성 (완료: 현재 약 250개 이상 INSERT 문)
  - ✅ USER: 10개
  - ✅ SURVEYS: 20개 (기존 16개 + 신규 4개)
  - ✅ QUESTIONS: 8개 (신규 설문 4개에 대한 질문)
  - ✅ OPTIONS: 21개 (객관식 질문 4개에 대한 옵션)
  - ✅ RESPONSES: 약 140개 (신규 설문 4개에 대한 대량 응답)
  - ✅ SURVEY_RESPONSE_HISTORY: 약 70개 (신규 설문 응답 이력)
  - [ ] 기존 설문(1-16)에 대한 질문/옵션/응답 데이터 (향후 추가 가능)
- [x] 적절한 주석 추가 (섹션별 구분)
- [x] 실행 순서 보장
  1. USER ✅
  2. SURVEYS ✅
  3. QUESTIONS (진행 중)
  4. OPTIONS (진행 중)
  5. RESPONSES (진행 중)
  6. SURVEY_RESPONSE_HISTORY (진행 중)
  7. NOTIFICATIONS (선택사항)

#### 🔍 3.3 최종 검토
- [ ] INSERT 문 실행 순서 확인
- [ ] ID 참조 정확성 검증 (AUTO_INCREMENT ID 참조 시 주의)
- [ ] 데이터 양 확인 (100~500개 INSERT 문)
- [ ] SQL 문법 검증
- [ ] 실제 DB에 테스트 실행 (선택사항)

## 데이터 생성 규칙

### 사용자 데이터
- USERNAME: `test_creator_1@example.com` 형식
- PASSWORD: BCrypt 해시 (테스트용)
- BIRTH_DATE: 1980-01-01 ~ 2000-12-31 범위
- ROLE: CREATOR (대부분), ADMIN (일부), RESPONDER (선택)

### 설문 데이터
- TITLE: 다양한 주제 (예: "서비스 만족도 조사", "제품 피드백 수집")
- DESCRIPTION: 간단한 설명 텍스트
- START_TIME: 과거/현재/미래 혼합
- END_TIME: START_TIME 이후 최소 7일 ~ 최대 90일
- IS_ACTIVE: TRUE (80%), FALSE (20%)
- IS_DELETED: FALSE (90%), TRUE (10%)

### 질문 데이터
- **지원되는 질문 타입:**
  - MULTIPLE_CHOICE: 2~5개 옵션 필수
  - SUBJECTIVE: 자유 텍스트 입력
- **미지원 타입:** SCALE (데이터베이스에 정의되어 있으나 현재 시스템에서 지원하지 않음)
- ORDER_INDEX: 1부터 시작하여 연속

### 응답 데이터
- responseSessionId: UUID v4 형식
- **지원되는 질문 타입별 응답:**
  - MULTIPLE_CHOICE: 해당 질문의 OPTION_ID 중 하나 (OPTION_ID 필수, SUBJECTIVE_CONTENT와 SCALE_VALUE는 NULL)
  - SUBJECTIVE: 실제적인 답변 텍스트 (한글/영문 혼합) (SUBJECTIVE_CONTENT 필수, OPTION_ID와 SCALE_VALUE는 NULL)
- **미지원:** SCALE 타입 응답 (현재 시스템에서 지원하지 않으므로 생성하지 않음)
- CREATED_AT: 설문 기간 내 랜덤 분산

### 응답 이력 데이터
- DEVICE_ID_HASH: SHA256("device_" + random_number)
- IP_ADDRESS_HASH: SHA256("192.168.1." + random_number) 형식
- RESPONDED_AT: RESPONSES.CREATED_AT와 일치

## 참고 사항
- AUTO_INCREMENT ID는 실제 생성 순서에 따라 결정되므로, 하드코딩된 ID 참조 시 주의
- UUID는 각 응답 세션마다 고유해야 함
- 해시 값은 실제 값의 SHA256 해시여야 함
- 날짜/시간은 MySQL DATETIME 형식 ('YYYY-MM-DD HH:MM:SS')
- ENUM 값은 대소문자 구분
- **중요:** SCALE 질문 타입은 데이터베이스 스키마에 정의되어 있으나, 현재 시스템에서 지원하지 않으므로 테스트 데이터 생성 시 제외해야 함
  - 질문 생성 시 MULTIPLE_CHOICE와 SUBJECTIVE 타입만 사용
  - 응답 생성 시 SCALE_VALUE는 사용하지 않음

## 진행 상황
- [x] TODO 리스트 작성
- [x] 데이터베이스 스키마 분석
- [x] 데이터 흐름 분석
- [x] 제약 조건 파악
- [x] 테스트 데이터 생성 (완료)
  - [x] 사용자 데이터 생성 완료 (10명)
  - [x] 설문 데이터 생성 완료 (20개 - 기존 16개 + 신규 4개)
  - [x] 질문 데이터 생성 완료 (신규 설문 4개에 대해 8개 질문)
  - [x] 옵션 데이터 생성 완료 (21개 옵션)
  - [x] 응답 데이터 생성 완료 (신규 설문에 대해 약 140개 응답, 70개 응답 세션)
  - [x] 응답 이력 데이터 생성 완료 (약 70개 이력)
  - [ ] 기존 설문(1-16)에 대한 질문/옵션/응답 데이터 (향후 추가 가능)
- [x] SQL 파일 생성 (완료: 약 250개 이상 INSERT 문 생성됨)
- [-] 최종 검토 (진행 중)

## 현재 작업 상태

### 완료된 작업
1. ✅ 데이터베이스 스키마 및 제약 조건 분석 완료
2. ✅ 사용자 데이터 생성 (CREATOR 8명, ADMIN 2명)
3. ✅ 설문 데이터 생성 (16개 설문)
4. ✅ test_data.sql 파일 기본 구조 생성

### 진행 중인 작업
1. ⏳ 질문 데이터 생성 (각 설문당 3-7개)
2. ⏳ 옵션 데이터 생성 (객관식 질문용)
3. ⏳ 응답 데이터 생성 (각 설문당 10-50개 응답 세션)
4. ⏳ 응답 이력 데이터 생성

### 다음 단계
- Python 스크립트(`generate_test_data.py`)를 실행하여 나머지 데이터 생성
  - 또는 수동으로 SQL 파일에 질문/옵션/응답 데이터 추가
- 최종적으로 100-500개의 INSERT 문 생성 목표

## 작업 정보 요약

### 테이블별 필수 정보

#### USER 테이블
- PASSWORD: BCrypt 해시 (BCryptPasswordEncoder 사용)
- 예시: "$2a$10$N9qo8uLOickgx2ZMRZoMyeIjZAgcfl7p92ldGxad68LJZdL17lhWy" (비밀번호 "password123"의 예시)

#### SURVEYS 테이블
- START_TIME: NULL 허용 (과거/현재/미래 혼합)
- END_TIME: 필수, START_TIME보다 이후
- IS_ACTIVE: 기본값 TRUE
- IS_DELETED: 기본값 0 (FALSE)

#### QUESTIONS 테이블
- TYPE: MULTIPLE_CHOICE 또는 SUBJECTIVE만 사용 (SCALE 미지원)
- ORDER_INDEX: 1부터 시작, 연속 번호

#### RESPONSES 테이블
- RESPONSE_SESSION_ID: UUID v4 형식 (36자)
- MULTIPLE_CHOICE: OPTION_ID 필수, SUBJECTIVE_CONTENT NULL, SCALE_VALUE NULL
- SUBJECTIVE: SUBJECTIVE_CONTENT 필수, OPTION_ID NULL, SCALE_VALUE NULL

#### SURVEY_RESPONSE_HISTORY 테이블
- DEVICE_ID_HASH: SHA256 해시를 Base64 인코딩 (HashUtil.encodeSha256)
- IP_ADDRESS_HASH: SHA256 해시를 Base64 인코딩 (nullable)

### 다음 작업에 필요한 핵심 정보
1. **BCrypt 해시 생성**: 테스트용 비밀번호 "test1234" → BCrypt 해시 생성 필요
2. **UUID 생성**: 각 응답 세션마다 고유 UUID 필요
3. **SHA256 Base64 해시**: deviceId와 ipAddress를 HashUtil.encodeSha256로 변환
4. **날짜 생성**: 현재 시간 기준으로 다양한 날짜 생성 (과거/현재/미래)
5. **ID 참조**: AUTO_INCREMENT이므로 순차적으로 생성하며 참조 관계 유지

